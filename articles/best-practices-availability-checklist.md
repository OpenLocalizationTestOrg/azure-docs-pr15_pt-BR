<properties
   pageTitle="Lista de verificação de disponibilidade | Microsoft Azure"
   description="Lista de verificação que fornece orientação para questões de disponibilidade durante o design."
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="masimms"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/13/2016"
   ms.author="masashin"/>

# <a name="availability-checklist"></a>Lista de verificação de disponibilidade

[AZURE.INCLUDE [pnp-header](../includes/guidance-pnp-header-include.md)]

## <a name="application-design"></a>Design de aplicativo

- **Evite qualquer ponto único de falha.** Todos os componentes, serviços, recursos e instâncias de computação devem ser implantadas como várias instâncias para impedir a afetar a disponibilidade de um único ponto de falha. Isso inclui mecanismos de autenticação. Projetar o aplicativo seja configurável para usar várias instâncias e para detectar falhas automaticamente e redirecionar solicitações para sem falha instâncias onde a plataforma não faz isso automaticamente.
- **Decomponha carga de trabalho por contrato de nível de serviço diferente.** Se um serviço for composto de cargas de trabalho e menos crítica, gerenciá-los de forma diferente e especifique os recursos de serviço e o número de instâncias atender aos requisitos de disponibilidade.
- **Minimizar e entender dependências de serviço.** Minimizar o número de diferentes serviços usada onde possível e certifique-se de que você compreender todas as dependências de recurso e serviço que existem no sistema. Isso inclui a natureza dessas dependências e o impacto de falha ou reduzido o desempenho em cada um no aplicativo geral. Microsoft pelo menos garante disponibilidade de 99,9% para a maioria dos serviços, mas isso significa que o que cada serviço adicional um aplicativo depende potencialmente reduz a disponibilidade geral SLA do seu sistema de 0,1%.
- **Mensagens sejam idempotentes (com segurança repetitivo) onde possível e tarefas de design**, portanto que duplicado solicitações não causará problemas. Por exemplo, um serviço pode atuar como um consumidor que trata as mensagens enviadas como solicitações por outras partes do sistema que atuam como produtores. Se o consumidor falhar após processamento da mensagem, mas antes de confirmar que ele foi processado, um produtor pode enviar uma solicitação de repetição que pode ser tratada por outra instância do consumidor. Por esse motivo, consumidores e as operações que eles executam devem ser idempotentes para que uma operação executada anteriormente de repetição não processar os resultados inválidos. Isso pode significa detectar duplicado mensagens ou garantir a consistência usando uma abordagem otimista para tratar os conflitos.
- **Use um agente de mensagem que implementa alta disponibilidade para as transações críticas.** Muitos cenários para iniciar as tarefas ou acessar serviços remota usam o sistema de mensagens para passar instruções entre o aplicativo e o serviço de destino. Para obter melhor desempenho, o aplicativo deve ser capaz de enviar a mensagem e retorne para processar mais solicitações, sem precisar aguardar uma resposta. Para garantir a entrega de mensagens, o sistema de mensagens deve fornecer alta disponibilidade. Filas de mensagens do Azure barramento de serviço implementam semântica _pelo menos uma vez_ . Isso significa que cada mensagem postada uma fila não serão perdida, embora cópias duplicadas podem ser entregue em determinadas circunstâncias. Se o processamento de mensagens for idempotente (consulte o item anterior), repetido entrega não deve ser um problema.
- **Aplicativos de design para prejudicar normalmente** quando atingir os limites do recurso e ação apropriada leve para minimizar o impacto do usuário. Em alguns casos, a carga no aplicativo pode exceder a capacidade de um ou mais partes, causando reduzido disponibilidade e conexões com falha. Dimensionamento pode ajudar a minimizar esse problema, mas ele pode atingir um limite imposto por outros fatores, como disponibilidade do recurso ou custo. Crie o aplicativo para que, nesse caso, ele pode automaticamente prejudicar normalmente. Por exemplo, um sistema de comércio, se o subsistema de processamento de pedidos está sob o esforço (ou até mesmo falhou completamente), ele pode ser temporariamente desabilitado enquanto permite que outros tipos de funcionalidade (como o catálogo de produtos de navegação) para continuar. Talvez seja apropriado adiar solicitações em um subsistema de falha, por exemplo ainda permitindo que os clientes enviar pedidos, mas salvá-los para processamento posterior, quando o subsistema de pedidos está disponível novamente.
- **Manipular normalmente eventos intermitente rápida.** A maioria dos aplicativos precisa tratar variadas cargas de trabalho ao longo do tempo, como picos primeira coisa de manhã em um aplicativo de negócios ou quando um novo produto for lançado em um site de comércio eletrônico. A escala automática pode ajudar a lidar com a carga, mas pode levar algum tempo para instâncias adicionais ficar online e lidar com solicitações. Impedir que súbita e inesperados explosões de atividade sobrecarregar o aplicativo: projetá-lo para solicitações de fila para os serviços que ele usa e prejudicar normalmente quando filas são próximo da capacidade total. Certifique-se de que há desempenho e capacidade suficientes disponível em condições não intermitente descarregar filas e lidar com solicitações pendentes. Para obter mais informações, consulte o [padrão de redistribuição de carga baseado em fila](https://msdn.microsoft.com/library/dn589783.aspx).

## <a name="deployment-and-maintenance"></a>Implantação e manutenção

- **Implante várias instâncias de funções para cada serviço.** Microsoft torna as garantias de disponibilidade para serviços que você criar e implantar, mas essas garantias somente são válidas se você implantar pelo menos duas instâncias de cada função no serviço. Isso permite que uma função seja indisponível enquanto outro permanece ativo. Isso é especialmente importante se você precisar implantar atualizações em um sistema ao vivo sem interromper atividades dos clientes; instâncias podem ser feitas para baixo e atualizadas individualmente, enquanto as outras continuam online.
- **Aplicativos de host em vários data centers.** Embora muito provavelmente não é possível para um data center inteiro fique off-line por meio de um evento como um desastre natural ou falha na Internet. Aplicativos de negócios vital devem estar hospedados em mais de um data center para fornecer disponibilidade máxima. Isso também pode reduzir a latência para usuários locais e fornecer oportunidades adicionais para flexibilidade ao atualizar aplicativos.
- **Automatizar e teste tarefas de implantação e manutenção.** Aplicativos distribuídos consistem em várias partes que devem trabalhar juntos. Implantação, portanto, deve ser automatizada, usando mecanismos testados e como scripts e aplicativos de implantação. Esses podem atualizar e validar a configuração e automatizar o processo de implantação. Técnicas automatizadas também devem ser usadas para executar atualizações de todo ou partes de aplicativos. É fundamental para testar todos esses processos totalmente para garantir que erros não causam tempo de inatividade adicional. Todas as ferramentas de implantação devem ter restrições de segurança adequado para proteger o aplicativo implantado; definir e aplicar políticas de implantação cuidadosamente e minimizar a necessidade de intervenção humana.
- **Considere o uso de recursos de estágios e de produção da plataforma** onde elas estão disponíveis. Por exemplo, usar os ambientes de produção e de teste de serviços de nuvem do Azure permite que os aplicativos de ser trocado entre si instantaneamente por meio de uma troca de endereço IP virtual (VIP troca). No entanto, se você preferir estágio no local, ou implantar diferentes versões do aplicativo simultaneamente e gradualmente migrar usuários, você não poderá usar uma operação de troca de VIP.
- **Aplicar alterações de configuração sem reciclagem** a instância quando possível. Em muitos casos, as configurações de um aplicativo do Azure ou serviço podem ser alteradas sem a necessidade da função ser reiniciado. Função expor eventos que podem ser tratados para detectar alterações na configuração e aplicá-las aos componentes dentro do aplicativo. No entanto, algumas alterações nas configurações de plataforma core exigir uma função para ser reiniciado. Ao criar serviços e componentes, maximizar a disponibilidade e minimizar o tempo de inatividade criando-los para aceitar alterações na configuração sem exigir que o aplicativo como um todo seja reiniciado.
- **Use domínios de atualização para o tempo de inatividade zero durante as atualizações.** Unidades como web de computação do Azure e funções de trabalho estão alocadas para atualizar domínios. Atualize instâncias de função de grupo de domínios juntos para que, quando ocorre uma atualização sem interrupção, cada função no domínio de atualização for interrompida, atualizada e reiniciada alternadamente. Isso minimiza o impacto na disponibilidade do aplicativo. Você pode especificar quantos domínios atualização devem ser criados para um serviço quando o serviço é implantado.

    > [AZURE.NOTE] Funções também são distribuídas entre domínios de falha, cada um dos quais é razoavelmente independente de outros domínios de falha em termos de rack de servidor, energia e refrigeração provisionar, para minimizar a possibilidade de uma falha que afetam todas as instâncias de função. Essa distribuição ocorre automaticamente, e você não pode controlá-lo.

- **Configure os conjuntos de disponibilidade do Azure máquinas virtuais.** Colocando dois ou mais máquinas virtuais no mesmo conjunto de disponibilidade garante que essas máquinas virtuais não serão implantadas para o mesmo domínio de falhas. Para maximizar a disponibilidade, você deve criar várias instâncias de cada máquina virtual crítica usado pelo seu sistema e coloque essas instâncias no mesmo conjunto de disponibilidade. Se você estiver executando várias máquinas virtuais que têm finalidades diferentes, crie uma disponibilidade definido para cada máquina virtual. Adicione instâncias de cada máquina virtual para cada conjunto de disponibilidade. Por exemplo, se você tiver criado máquinas virtuais separadas para agir como um servidor web e um servidor de relatórios, crie uma disponibilidade definido para o servidor da web e outra disponibilidade definido para o servidor de relatórios. Adicione instâncias da máquina web servidor virtual para a disponibilidade de servidor web definir e adicionar instâncias da máquina virtual server reporting ao conjunto de disponibilidade de servidor de relatórios.

## <a name="data-management"></a>Gerenciamento de dados

- **Tirar proveito de replicação de dados** local e geográfica redundância. Dados de armazenamento do Azure são duplicados automaticamente para proteger contra perda em caso de falha de infraestrutura e alguns aspectos dessa replicação podem ser configurados. Por exemplo, cópias somente leitura de dados podem ser duplicadas em mais de uma determinada área geográfica (referida como armazenamento globalmente redundante de acesso de leitura ou ar GRS). Observe que o uso de ar GRS gera cobranças adicionais. Para obter detalhes, consulte [Preços de armazenamento do Azure](https://azure.microsoft.com/pricing/details/storage/).
- **Concorrência otimista de uso e a consistência eventual** sempre que possível. Transações que bloquear o acesso aos recursos através do bloqueio de (concorrência pessimista) pode causar mau desempenho e reduzir consideravelmente disponibilidade. Esses problemas podem se tornar especialmente agudos em sistemas distribuídos. Em muitos casos, design cuidado e técnicas como partição podem minimizar as chances de atualizações conflitantes ocorrendo. Onde dados são duplicados ou ser lido em uma loja separadamente atualizada, os dados só serão eventualmente consistentes. Mas as vantagens geralmente muito maiores do que o impacto sobre a disponibilidade do uso de transações para garantir a consistência imediata.
- **Usar periódico backup e restauração no momento**e certifique-se de que ele atende o objetivo de ponto de recuperação (RPO). Regularmente automaticamente fazer backup de dados que não são preservados em outro lugar e verificar que você pode confiavelmente restaurar os dados e o próprio aplicativo deve ocorrer uma falha. Replicação de dados não é um recurso de backup porque erros e inconsistências apresentadas por meio de operações mal-intencionados, erro ou falha serão replicadas em todas as lojas. O processo de backup deve ser seguro para proteger os dados em trânsito e armazenamento. Bancos de dados ou partes de um armazenamento de dados podem geralmente ser recuperados a um ponto anterior no tempo usando os logs de transação. Microsoft Azure fornece um recurso de backup para dados armazenados no Azure SQL Database. Os dados são exportados para um pacote de backup em armazenamento de blob do Microsoft Azure e podem ser baixados para um local seguro no local de armazenamento.
- **Habilite a opção de alta disponibilidade manter uma cópia secundária de um cache Azure relacionada.** Ao usar o Cache do Azure relacionada, escolha a opção padrão para manter uma cópia secundária do conteúdo. Para obter mais informações, consulte [criar um cache no Cache relacionada do Azure](https://msdn.microsoft.com/library/dn690516.aspx).

## <a name="errors-and-failures"></a>Erros e falhas

- **Apresente o conceito de um tempo limite.** Serviços e recursos podem ficar indisponíveis, causando solicitações falha. Certifique-se de que os tempos limite aplicar são apropriados para cada serviço ou recurso, além do cliente que está acessando-los. (Em alguns casos, pode ser apropriado permitir um tempo limite maior para uma determinada instância de um cliente, dependendo do contexto e outras ações que o cliente está executando.) Tempo limite muito curto pode causar operações de repetir excessiva para serviços e recursos que têm latência considerável. Tempos limite muito longa pode causar bloqueio se um grande número de solicitações é enfileirado, aguardando para um serviço ou recurso responder.
- **Repetir causadas por falhas temporárias de operações com falha.** Criar uma estratégia de Repetir para obter acesso a todos os serviços e recursos onde eles não ofereça suporte a conexão automática novamente. Use uma estratégia que inclui um atraso crescente entre tentativas como o número de falhas aumenta, para evitar sobrecarga do recurso e permitir que ele normalmente recuperar e lidar com solicitações na fila. Repetições contínuas com atrasos muito curtos serão prováveis exacerbar o problema.
- **Parar de enviar solicitações para evitar falhas em cascata** quando serviços remota não estão disponíveis. Pode haver situações nas quais transitório ou outras falhas, variando gravidade de uma perda parcial de conectividade para falha completa de um serviço, levar muito mais tempo do que o esperado para voltar ao normal. Além disso, se um serviço está muito ocupado, falha em uma parte do sistema pode levar a falhas em cascata e resultar em muitas operações fiquem bloqueadas enquanto mantém em recursos críticos do sistema como memória, threads e conexões de banco de dados. Em vez de continuamente repetindo uma operação que provavelmente não tenha êxito, o aplicativo deve aceitar rapidamente que a operação falhou e lidar com essa falha. Você pode usar o padrão de separador de circuito para rejeitar solicitações para operações específicas por períodos definidos. Para obter mais detalhes, consulte [Circuito separador padrão](https://msdn.microsoft.com/library/dn589784.aspx).
- **Redigir ou retorno para vários componentes** para reduzir o impacto de um serviço específico sendo offline ou indisponível. Crie aplicativos para tirar proveito de várias instâncias sem afetar operação e conexões existentes sempre que possível. Usar várias instâncias e distribuir solicitações entre eles e detectar e evitar o envio de solicitações para instâncias com falha, para maximizar a disponibilidade.
- **Retorno para um serviço diferente ou o fluxo de trabalho** sempre que possível. Por exemplo, se escrita banco de dados SQL falhar, temporariamente armazene dados no armazenamento de blob. Forneça um recurso para reproduzir as gravações no armazenamento de blob banco de dados SQL quando o serviço fica disponível. Em alguns casos, uma operação com falha pode ter uma ação alternativa que permite que o aplicativo para continuar a trabalhar mesmo quando um componente ou serviço falha. Se possível, detectar falhas e redirecionar solicitações para outros serviços que podem oferecer uma funcionalidade alternativa adequada, ou para fazer backup ou instâncias de funcionalidade reduzida que podem manter operações principais enquanto o serviço principal está offline.

## <a name="monitoring-and-disaster-recovery"></a>Monitoramento e recuperação de desastres

- **Fornecer instrumentação avançada para provavelmente falhas e eventos de falha** para relatar a situação à equipe de operações. Para falhas que provavelmente mas ainda não tenha ocorrido, fornecer dados suficientes para permitir que a equipe de operações determinar a causa, atenuar a situação e certifique-se de que o sistema continua disponível. Falhas que já ocorreram, o aplicativo deve retornar uma mensagem de erro apropriado para o usuário mas tentará continuar executando, embora com funcionalidade reduzida. Em todos os casos, o sistema de monitoramento deve capturar detalhes abrangentes para habilitar a equipe de operações efeito uma recuperação rápida e se necessário, para designers e desenvolvedores modificar o sistema impedir que a situação surgem novamente.
- **Monitorar a saúde do sistema implementando funções de verificação.** A integridade e o desempenho de um aplicativo podem prejudicar ao longo do tempo, sem ser perceptível até falhar. Implementar testes ou verificar as funções que são executadas regularmente de fora do aplicativo. Essas verificações podem ser tão simples quanto tempo de resposta para o aplicativo como um todo, para partes individuais do aplicativo, para serviços individuais que o aplicativo usa ou de componentes individuais de medição. Funções de seleção podem executar processos para garantir que eles produzirem resultados válidos, medem latência verificar a disponibilidade e extraem informações do sistema.
- **Testar regularmente todos os sistemas de fallback e failover** para garantir que eles estão disponíveis e funcionam como esperado. As alterações aos sistemas e operações podem afetar failover e funções de fallback, mas o impacto pode não ser detectado até que o sistema principal falhar ou fica sobrecarregado. Teste-a antes de ela é necessária para compensar um problema ao vivo em tempo de execução.
- **Teste os sistemas de monitoramento.** Failover automatizado e sistemas de fallback e visualização manual de saúde do sistema e desempenho usando painéis, todos dependem de monitoramento e instrumentação funcionando corretamente. Se esses elementos falharem, perda informações críticas, ou relatar dados incorretos, um operador não pode perceber que o sistema está com problemas ou falhando.
- **Controlar o progresso de fluxos de trabalho de execução demorada** e tente novamente em caso de falha. Fluxos de trabalho de execução longa geralmente são compostos de várias etapas. Certifique-se de que cada etapa é independente e pode ser repetida para minimizar a possibilidade de que o fluxo de trabalho inteiro precisarão ser revertidas ou que várias transações compensação precisam ser executadas. Monitorar e gerenciar o progresso de fluxos de trabalho de execução longa implementando um padrão como o [Agendador do agente Supervisor padrão](https://msdn.microsoft.com/library/dn589780.aspx).
- **Plano de recuperação de dados.** Certifique-se de que um plano totalmente testado documentado e aceito recuperação de qualquer tipo de falha que podem ser renderizados parte ou todo o sistema principal estiver disponível. Testar os procedimentos regularmente e certifique-se de que toda a equipe de operações esteja familiarizada com o processo.
