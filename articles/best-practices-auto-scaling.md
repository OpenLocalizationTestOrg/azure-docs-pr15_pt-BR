<properties
   pageTitle="Orientação de AutoScaling | Microsoft Azure"
   description="Orientação sobre como escala automática para alocar dinamicamente os recursos necessários por um aplicativo."
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="christb"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/13/2016"
   ms.author="masashin"/>

# <a name="autoscaling-guidance"></a>Orientação de AutoScaling

[AZURE.INCLUDE [pnp-header](../includes/guidance-pnp-header-include.md)]

## <a name="overview"></a>Visão geral
AutoScaling é o processo de alocação dinamicamente os recursos necessários por um aplicativo para atender às necessidades de desempenho e atender a contratos de nível de serviço (SLAs), minimizando custos de tempo de execução. Conforme o volume de trabalho aumenta, um aplicativo pode exigir recursos adicionais para ativá-lo executar suas tarefas em tempo hábil. Como demanda slackens, os recursos podem ser eliminação alocados para minimizar os custos, e ainda mantendo o desempenho adequado e SLAs de reunião.
AutoScaling tira proveito da elasticidade de ambientes hospedados em nuvem enquanto atenuação sobrecarga de gerenciamento. Ele faz isso, reduzindo a necessidade de um operador monitorar o desempenho de um sistema continuamente e tomar decisões sobre como adicionar ou remover recursos.
>[AZURE.NOTE] AutoScaling aplica-se a todos os recursos usados por um aplicativo, não apenas os recursos de computação. Por exemplo, se seu sistema usa filas de mensagens para enviar e receber informações, ele pode criar filas adicionais como ele pode ser expandido.

## <a name="types-of-scaling"></a>Tipos de dimensionamento
Dimensionamento normalmente leva uma das duas formas a seguir:

- **Vertical** (conhecida como _dimensionamento para cima e para baixo_). Este formulário requer que você modifique o hardware (expandir ou reduzir seu desempenho e capacidade), ou reimplantar a solução usando hardware alternativo que tem a capacidade apropriada e o desempenho. Em um ambiente de nuvem, a plataforma de hardware costuma ser um ambiente virtualizado. A menos que o hardware original foi pelo substancialmente excesso, com as resultante despesas de capital antecipada, verticalmente chegando nesse ambiente envolve provisionamento de recursos mais eficazes e movendo o sistema nesses novos recursos. Dimensionamento vertical geralmente é um processo interrupções que exige tornando o sistema temporariamente indisponível enquanto ele está sendo redistribuído. Talvez seja possível manter o sistema original em execução enquanto o novo hardware está provisionado e colocado online, mas há provavelmente será algumas interrupções enquanto as transições de processamento do ambiente antigo para o novo. É incomum usar auto-escala implementar uma estratégia de dimensionamento vertical.
- **Horizontal** (conhecida como _dimensionamento in e check-out_). Este formulário requer a implantação da solução adicionais ou menos recursos, que geralmente são recursos de mercadoria em vez de sistemas de alta potência. A solução pode continuar a execução sem interrupção enquanto esses recursos são provisionados. Quando o processo de provisionamento estiver concluído, cópias de elementos que compõem a solução podem ser implantadas nestes recursos adicionais e disponíveis. Se a demanda cai, os recursos adicionais podem ser recuperados depois os elementos usá-los tem sido encerrados corretamente. Muitos sistemas baseado em nuvem, incluindo o Microsoft Azure, oferecem suporte a automação dessa forma de dimensionamento.

## <a name="implement-an-autoscaling-strategy"></a>Implemente uma estratégia de autoscaling
Implementação de uma estratégia de autoscaling normalmente envolve os seguintes componentes e processos:

- Instrumentação e monitoramento sistemas nos níveis de aplicativo, o serviço e infraestrutura. Esses sistemas capturam métricas-chave, como tempos de resposta, comprimentos de filas, utilização da CPU e uso de memória.
- Lógica de tomada de decisão que pode avaliar os fatores de dimensionamento monitorados contra limites predefinidos do sistema ou agendas e tomar decisões sobre se deseja dimensionar ou não.
- Componentes que são responsáveis por realizando tarefas associadas com o sistema, como provisionamento eliminação de recursos ou de provisionamento de dimensionamento.
- Teste, monitoramento e ajuste da estratégia de autoscaling para garantir que ela funciona conforme esperado.

A maioria dos ambientes baseado em nuvem, como o Azure, fornecem mecanismos de autoscaling internos que cenários comuns do endereço. Se o ambiente ou serviço que você usar não oferece que o necessário automatizada funcionalidade dimensionamento ou se você tiver requisitos de autoscaling extremo além dos seus recursos, uma implementação personalizada pode ser necessária. Use esta implementação personalizada para coletar operacionais e métricas do sistema, analisá-los para identificar dados relevantes e dimensionar a recursos adequadamente.


## <a name="configure-autoscaling-for-an-azure-solution"></a>Configurar autoscaling para uma solução do Azure
Há várias opções para configurar autoscaling para suas soluções Azure:

- **Escala automática do Azure** suporta os cenários mais comuns de dimensionamento com base em um cronograma e, opcionalmente, acionado dimensionamento operações com base em métricas de tempo de execução (como utilização do processador, comprimento da fila ou contadores internos e personalizados). Você pode configurar diretivas de autoscaling simples para uma solução rapidez e facilidade usando o portal do Azure. Para obter mais controle, você pode fazer uso de [API REST do Azure serviço Gerenciamento](https://msdn.microsoft.com/library/azure/ee460799.aspx) ou a [API de REST do Azure Gerenciador de recursos](https://msdn.microsoft.com//library/azure/dn790568.aspx). A [Biblioteca de gerenciamento de serviço de monitoramento do Azure](http://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring) e a [Biblioteca do Microsoft ideias](https://www.nuget.org/packages/Microsoft.Azure.Insights/) (na visualização) são SDKs que permitem a coleta de avaliação de diferentes recursos e executam autoscaling fazendo usar das APIs REST. Para recursos onde o suporte do Gerenciador de recursos do Azure não estiver disponível, ou se você estiver usando os serviços de nuvem do Azure, a API do serviço Gerenciamento restante pode ser usada para autoscaling. Em todos os outros casos, use o Gerenciador de recursos do Azure.
- **Uma solução personalizada**, com base em sua instrumentação no aplicativo e recursos de gerenciamento do Azure, pode ser útil. Por exemplo, você poderia usar o diagnóstico do Azure ou outros métodos de instrumentação em seu aplicativo, juntamente com código personalizado para monitorar e exportar métricas do aplicativo continuamente. Você poderia ter regras personalizadas que trabalhe nessas métricas e utilizar o gerenciamento de serviço ou REST API de Gerenciador de recursos do disparar autoscaling. As métricas para acionar uma operação de escala podem ser qualquer contador interna ou personalizada ou outra instrumentação que implementar dentro do aplicativo. Entretanto, uma solução personalizada não é simple de implementar e deve ser considerado de apenas se nenhuma das anteriores abordagens possam atender suas necessidades. O [Bloco de aplicativo Autoscaling](http://msdn.microsoft.com/library/hh680892%28v=pandp.50%29.aspx) faz uso dessa abordagem.
- **Serviços de terceiros**, como o [Paraleap AzureWatch](http://www.paraleap.com/AzureWatch), permitem que você dimensionar uma solução baseada em agendas, indicadores de desempenho de carga e o sistema de serviço, regras personalizadas e combinações de diferentes tipos de regras.

Ao escolher qual solução autoscaling adotem, considere os seguintes pontos:

- Use os recursos de autoscaling internos da plataforma, se eles podem atender às suas necessidades. Caso contrário, considere cuidadosamente se você realmente precisa recursos mais complexos de dimensionamento. Alguns exemplos de requisitos adicionais podem incluir mais detalhamento de controle, maneiras diferentes para detectar eventos de disparador para dimensionamento, dimensionamento em assinaturas e outros tipos de recursos de dimensionamento.
- Considere se você pode prever a carga no aplicativo com precisão suficiente dependem apenas autoscaling agendada (adicionando e Removendo instâncias para atender previstos picos em demanda). Onde esse não for possível, use reativa auto-escala baseada em métricas coletadas durante a execução, para permitir que o aplicativo lidar com mudanças repentinas em demanda. Normalmente, você pode combinar essas abordagens. Por exemplo, crie uma estratégia que adiciona recursos como computação, armazenamento e filas, com base em um cronograma das vezes quando você souber que o aplicativo é mais ocupado. Isso ajuda a garantir que a capacidade estará disponível quando necessário, sem o atraso encontrado ao iniciar novas instâncias. Além disso, para cada regra agendada, defina avaliações que permitem autoscaling reativo durante esse período para garantir que o aplicativo pode manipular picos contínuo, mas imprevisíveis em demanda.
- Muitas vezes é difícil entender a relação entre os requisitos de capacidade e métricas, especialmente quando um aplicativo é implantado inicialmente. Prefere provisionar um pouco capacidade extra no início e, em seguida, monitorar e ajustar as regras de autoscaling para trazer a capacidade mais próximo para a carga real.

### <a name="use-azure-autoscale"></a>Usar escala automática Azure
Escala automática permite que você configure escala e dimensionar nas opções para uma solução. Escala automática automaticamente pode adicionar e remover instâncias da web de serviços de nuvem do Azure e funções de trabalho, serviços de celular do Azure e recurso Web Apps em um serviço de aplicativo do Azure. Ele também pode habilitar o dimensionamento automático Iniciando e interrompendo instâncias de máquinas virtuais do Azure. Uma estratégia de autoscaling Azure inclui dois conjuntos de fatores:

- Auto-escala baseada em cronograma que pode garantir instâncias adicionais estão disponíveis para coincidir com um pico esperado em uso e podem aumentar em após o horário de pico passou. Isso permite garantir que você tenha suficientes instâncias já em execução, sem aguardar a reagir à carga do sistema.
- Auto-escala baseada em métricas que reage a fatores como utilização média da CPU por meio de última hora ou o registro acumulado das mensagens que a solução está processando em um armazenamento do Azure ou fila de barramento de serviço do Azure. Isso permite que o aplicativo reagir separadamente das regras autoscaling agendada para acomodar alterações planejadas ou inesperadas em demanda.

Ao usar escala automática, considere os seguintes pontos:

- Sua estratégia de autoscaling combina agendado e baseados em métricas de dimensionamento. Você pode especificar os dois tipos de regras para um serviço.
- Você deve configurar as regras de autoscaling e, em seguida, monitorar o desempenho do seu aplicativo ao longo do tempo. Use os resultados deste monitoramento para ajustar a maneira em que o sistema escalas se necessário. No entanto, tenha em mente que autoscaling não é um processo instantâneo. Leva tempo para reagir a uma métrica como média CPU utilização excedem (ou ficam abaixo) um limite especificado.
- Regras de AutoScaling que usam um mecanismo de detecção com base em um atributo medido disparador (como comprimento de fila ou uso do CPU) usam um valor agregado ao longo do tempo, em vez de valores instantâneos, para acionar uma ação autoscaling. Por padrão, a agregação é uma média dos valores. Isso impede que o sistema de reagir muito rapidamente ou causando oscilação rápida. Ele também permite tempo para novas instâncias que são iniciados automaticamente para liquidar executem modo, impedindo ações adicionais autoscaling ocorra enquanto as novas instâncias estão iniciando. Para serviços de nuvem do Azure e máquinas virtuais do Azure, o período padrão para a agregação é 45 minutos, portanto pode levar a esse período de tempo para a métrica disparar autoscaling em resposta a picos de demanda. Você pode alterar o período de agregação usando o SDK, mas lembre-se de que períodos de menos de 25 minutos podem causar resultados inesperados (para obter mais informações, consulte [Serviços de nuvem dimensionamento automático em porcentagem de CPU com a biblioteca de gerenciamento de serviços de monitoramento de Azure](http://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/)). Para aplicativos Web, o período de averaging é muito menor, permitindo novas instâncias fique disponível em cerca de cinco minutos após uma alteração à medida disparador média.
- Se você configurar autoscaling usando o SDK em vez de portal da web, você pode especificar um agendamento mais detalhado durante o qual as regras estão ativas. Você também pode criar seus próprios métricas e usá-los com ou sem nenhuma das existentes nas suas regras autoscaling. Por exemplo, você talvez queira usar contadores alternativos, como o número de solicitações por segundo ou a disponibilidade de memória média, ou usar contadores personalizados que meçam processos de negócios específicos.
- Quando auto-dimensionamento máquinas virtuais do Azure, você deve implantar um número de instâncias da máquina virtual que é igual ao número máximo permitirá autoscaling iniciar. Essas instâncias devem fazer parte do mesmo conjunto disponibilidade. O mecanismo de autoscaling máquinas virtuais não criar ou excluir instâncias de máquina virtual; em vez disso, as regras de autoscaling que você configurar irá iniciar e parar um número adequado dessas instâncias. Para obter mais informações, consulte [Dimensionar automaticamente um aplicativo executando funções da Web, funções de trabalho ou máquinas virtuais](./cloud-services/cloud-services-how-to-scale.md).
- Se novas instâncias não podem ser iniciadas, talvez porque você atingiu o máximo para uma assinatura ou ocorre um erro durante a inicialização, o portal pode mostrar que uma operação de autoscaling bem-sucedido. No entanto, os eventos **ChangeDeploymentConfiguration** subsequentes exibidos no portal mostrará somente que uma inicialização de serviço foi solicitada e não haverá nenhum evento para indicar que foi concluída com êxito.
- Você pode usar a interface do usuário do portal da web para vincular recursos como instâncias de banco de dados SQL e filas a uma instância de serviço de computação. Isso permite que você acesse mais facilmente o separado manual e automático de dimensionamento opções de configuração para cada um dos recursos vinculados. Para obter mais informações, consulte [como: vincular um recurso a um serviço de nuvem](cloud-services-how-to-manage.md#linkresources) e [como dimensionar um aplicativo](./cloud-services/cloud-services-how-to-scale.md).
- Quando você configura várias regras e, eles podem entrar em conflito uns com os outros. Escala automática usa as seguintes regras de resolução de conflitos para garantir que sempre haja um número suficiente de instâncias em execução:
  - Escala de operações sempre precedência sobre escala em operações.
  - Quando dimensionar conflito de operações, a regra que inicia o maior aumento no número de instâncias terá precedência.
  - Quando dimensionar em conflito de operações, a regra que inicia o menor diminuir o número de instâncias terá precedência.

<a name="the-azure-monitoring-services-management-library"></a>

## <a name="application-design-considerations-for-implementing-autoscaling"></a>Considerações de design de aplicativo para implementar autoscaling
AutoScaling não é uma solução instantânea. Simplesmente adicionar recursos a um sistema ou executar mais ocorrências de um processo não garante que irão melhorar o desempenho do sistema. Considere os seguintes pontos ao criar uma estratégia de autoscaling:

- O sistema deve ser desenvolvido para ser scalable horizontalmente. Evite fazer suposições sobre afinidade de instância; não crie soluções que exigem que o código sempre é executado em uma instância específica de um processo. Ao dimensionar um site ou um serviço de nuvem horizontalmente, não pense que uma série de solicitações da mesma fonte sempre será roteada para a mesma instância. Pelo mesmo motivo, serviços seja independente para evitar a necessidade de uma série de solicitações de um aplicativo para sempre ser roteados para a mesma instância de um serviço de design. Ao criar um serviço que lê mensagens de uma fila e processa-los, não faça suposições sobre qual instância das alças de serviço de uma mensagem específica. AutoScaling pôde iniciar instâncias adicionais de um serviço que o comprimento da fila cresce. O [Padrão de consumidores que competem](http://msdn.microsoft.com/library/dn568101.aspx) descreve como lidar com esse cenário.
- Se a solução implementa uma tarefa demorada, design esta tarefa para oferecer suporte a dimensionamento e dimensionamento em. Sem vencimento cuidado, tal tarefa pode impedir que uma instância de um processo sendo desligado corretamente quando o sistema escalas no ou ele poderá perder dados se o processo é encerrado. Ideal seria refatorar uma tarefa demorada e dividir o processamento que ele executa em partes menores e discretos. A [Pipes e filtros padrão](http://msdn.microsoft.com/library/dn568100.aspx) fornece um exemplo de como você pode obter isso.
- Como alternativa, você pode implementar um mecanismo de ponto de verificação que registros de informações de estado sobre a tarefa em intervalos regulares e salvem este estado no armazenamento durável que possa ser acessado por qualquer instância do processo de execução da tarefa. Dessa forma, se o processo é encerrado, o trabalho que ela estava executando pode reiniciar a partir do último ponto de verificação usando outra instância.
- Quando tarefas em segundo plano executado em instâncias de computação separado, como no trabalho funções um de serviços de nuvem hospedado no aplicativo, você talvez precise dimensionar diferentes partes do aplicativo usando diferentes políticas de dimensionamento. Por exemplo, você talvez precise implantar computação de interface do usuário adicionais instâncias sem aumentar o número de plano de fundo calcular instâncias ou o oposto de isso. Se você oferecer níveis diferentes de serviço (como pacotes de serviços básicos e premium), talvez você precise dimensionar os recursos de computação para pacotes de serviço premium mais ativamente daquelas para os pacotes de serviço básico para atender aos SLAs.
- Considere usar o comprimento da fila sobre quais UI e plano de fundo de computação instâncias comunicam como critério para sua estratégia de autoscaling. Este é o melhor indicador de um desequilíbrio ou a diferença entre a carga atual e a capacidade de processamento da tarefa plano de fundo.
- Se você basear sua estratégia de autoscaling em contadores que medem processos de negócios, como o número de pedidos por hora ou o tempo de execução médio de uma transação complexa, certifique-se de que você compreenda a relação entre os resultados desses tipos de contadores e os requisitos de capacidade de computação real. Talvez seja necessário dimensionar mais de um componente ou calcular unidade em resposta a alterações em contadores de processo de negócios.  
- Para impedir a tentativa de dimensionar excessiva e para evitar os custos associados ao executar vários milhares de instâncias de um sistema, considere a possibilidade de limitar o número máximo de instâncias que podem ser adicionadas automaticamente. A maioria dos mecanismos de autoscaling permitem que você especifique o número mínimo e máximo de instâncias de uma regra. Além disso, considere a possibilidade de normalmente afetar a funcionalidade que o sistema fornece se o número máximo de instâncias foram implantado e o sistema ainda está sobrecarregado.
- Manter em mente que autoscaling talvez não seja o mecanismo mais adequado para lidar com um intermitente súbito na carga de trabalho. Leva tempo para provisionar e iniciar novas instâncias de um serviço ou adicionar recursos a um sistema e a demanda de pico pode ter passado pelo tempo que estes recursos adicionais foram disponibilizados. Nesse cenário, talvez seja melhor controlar o serviço. Para obter mais informações, consulte o [Padrão de otimização](http://msdn.microsoft.com/library/dn589798.aspx).
- Por outro lado, se precisar de capacidade para processar todas as solicitações quando o volume oscila rapidamente e custo não é um fator determinante principal, considere usar uma estratégia de autoscaling rigorosas que inicia instâncias adicionais mais rapidamente. Você também pode usar uma política programada que inicia um número suficiente de instâncias para atender a carga máxima antes de carga é esperada.
- O mecanismo de autoscaling deve monitorar o processo de autoscaling e faça logon os detalhes de cada evento autoscaling (o que disparou, quais recursos foram adicionados ou removidos e quando). Se você criar um mecanismo de autoscaling personalizado, certifique-se de que ele incorpora esse recurso. Analisar as informações para ajudar a medir a eficiência da estratégia de autoscaling e ajustá-lo se necessário. Você pode ajustar ambos a curto prazo, como os padrões de uso se tornar mais óbvias e sobre a longo prazo, como os negócios expande ou os requisitos do aplicativo evoluem. Se um aplicativo atingir o limite superior definido para auto-dimensionamento, o mecanismo também pode alertar um operador quem pode iniciar manualmente a recursos adicionais se necessário. Observe que, sob essas circunstâncias, o operador também pode ser responsável por remover manualmente esses recursos após alivia a carga de trabalho.

## <a name="related-patterns-and-guidance"></a>Orientação e padrões relacionados
Os padrões e diretrizes a seguir também podem ser relevantes para seu cenário ao implementar autoscaling:

- [A limitação padrão](http://msdn.microsoft.com/library/dn589798.aspx). Este padrão descreve como um aplicativo pode continuar a funcionar e atender aos SLAs quando um aumento de demanda coloca uma carga extrema em recursos. A otimização pode ser usada com autoscaling para impedir que um sistema sejam sobrecarregado enquanto o sistema se expande.
- [Que competem consumidores padrão](http://msdn.microsoft.com/library/dn568101.aspx). Este padrão descreve como implementar um pool de instâncias de serviço que pode lidar com mensagens de qualquer instância do aplicativo. AutoScaling pode ser usado para iniciar e interromper instâncias de serviço para corresponder a carga de trabalho antecipada. Essa abordagem habilita um sistema processar várias mensagens simultaneamente para otimizar a produtividade, melhorar a disponibilidade e escalabilidade e saldo a carga de trabalho.
- [Diretrizes de telemetria e instrumentação](http://msdn.microsoft.com/library/dn589775.aspx). Instrumentação e telemetria são essenciais para reunir as informações que podem direcionar o processo de autoscaling.

## <a name="more-information"></a>Mais informações
- [Como dimensionar um aplicativo](./cloud-services/cloud-services-how-to-scale.md)
- [Dimensionar automaticamente um aplicativo executando funções da Web, funções de trabalho ou máquinas virtuais](cloud-services-how-to-manage.md#linkresources)
- [Como: vincular um recurso a um serviço de nuvem](cloud-services-how-to-manage.md#linkresources)
- [Dimensionar recursos vinculados](./cloud-services/cloud-services-how-to-scale.md#scale-link-resources)
- [Biblioteca de gerenciamento de serviços de monitoramento do Azure](http://www.nuget.org/packages/Microsoft.WindowsAzure.Management.Monitoring)
- [Gerenciamento de serviço Azure API REST](http://msdn.microsoft.com/library/azure/ee460799.aspx)
- [Azure API REST de Gerenciador de recursos](https://msdn.microsoft.com/library/azure/dn790568.aspx)
- [Biblioteca de Microsoft Insights](https://www.nuget.org/packages/Microsoft.Azure.Insights/)
- [Operações em Autoscaling](http://msdn.microsoft.com/library/azure/dn510374.aspx)
- [Namespace Microsoft.WindowsAzure.Management.Monitoring.Autoscale](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.management.monitoring.autoscale.aspx)
